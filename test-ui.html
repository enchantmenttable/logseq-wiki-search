<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        li {
            border: 1px solid black;
            list-style: none;
        }

        div {
            border: 1px solid black;
        }

        #left-section,
        #right-section {
            width: 50%;
        }

        #wrapper {
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>
    <input type="search" id="search-bar">
    <div id="wrapper">
        <div id="left-section">
            <nav>
                <ul>
                </ul>
            </nav>
        </div>
        <div id="right-section">

        </div>
    </div>
    <script>
        const listItems = document.querySelector("#left-section > nav > ul");
        const rightSection = document.getElementById("right-section");
        const searchBar = document.getElementById("search-bar");

        function clearItems() {
            while (listItems.firstChild) {
                listItems.removeChild(listItems.lastChild);
            };

            while (rightSection.firstChild) {
                rightSection.removeChild(rightSection.lastChild);
            };
        }
        
        function delay(func, time) {
            let timer = 0;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(func.bind(this, ...args), time || 0)
            }
        }

        searchBar.addEventListener("keyup", delay(function (e) {
            updateItems(searchBar.value);
        }, 250));

        function updateItems(keyword) {
            const searchUrl = `https://en.wikipedia.org/w/rest.php/v1/search/page?q=${keyword}&limit=5`;

            //https://en.wikipedia.org/api/rest_v1/page/summary/

            fetch(searchUrl)
                .then(res => res.json())
                .then(data => {
                    updateItemTitle(data)
                })
        };

        function updateItemContent(url) {
            return fetch(url)
                .then(res => res.json())
                .then(data => {
                    rightSection.insertAdjacentHTML("beforeend",
                        `<p style="display:none">${data.extract}</p>`);

                    const lastItem = listItems.lastChild;
                    const lastItemContent = rightSection.lastChild;

                    lastItem.addEventListener("mouseover", () => {
                        lastItemContent.style.display = "block";
                    });
                    lastItem.addEventListener("mouseout", () => {
                        lastItemContent.style.display = "none";
                    })
                })
        }

        async function updateItemTitle(data) {
            clearItems();
            
            for (const entry of data.pages) {
                listItems.insertAdjacentHTML("beforeend", `<li>${entry.title}</li>`);

                const summaryUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${entry.key}`;

                await updateItemContent(summaryUrl);
            }
        }

    </script>
</body>

</html>
logseq.ready(function(){var e;let t,o,i,n;let a=document.getElementById("item-list"),r=document.getElementById("right-section"),c=document.getElementById("search-bar"),s=document.getElementById("background-layer"),l=-1,d=document.getElementsByTagName("body")[0];function u(){f(),c.value="",d.style.visibility="hidden",logseq.hideMainUI({restoreEditingcurrentIndex:!0})}function f(){for(;a.firstChild;)a.removeChild(a.lastChild);for(;r.firstChild;)r.removeChild(r.lastChild);l=-1}async function g(e,t){let o=await logseq.Editor.getCurrentBlock(),i=`${e}: ${t}`;""!=o.content?await logseq.Editor.insertBlock(o.uuid,i,{sibling:!0}):await logseq.Editor.updateBlock(o.uuid,i)}async function m(e,t){await logseq.Editor.insertAtEditingCursor(`[[${e}]]`),await p(e,t)}async function p(e,t){if(await logseq.Editor.getPage(e)){if(console.log("bruh"),null===await y(e)){await logseq.Editor.deletePage(e),await logseq.Editor.createPage(e,{},{createFirstBlock:!0,redirect:!1});let o=await y(e);o&&await logseq.Editor.updateBlock(o.uuid,t)}}else{await logseq.Editor.createPage(e,{},{createFirstBlock:!0,redirect:!1});let o=await y(e);o&&await logseq.Editor.updateBlock(o.uuid,t)}}async function y(e){let t=await logseq.Editor.getPageBlocksTree(e);return 0===t.length?null:t[t.length-1]}async function w(e){return fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${e}`).then(e=>e.json()).then(e=>e.extract)}async function b(e){return fetch(e).then(e=>e.json()).then(e=>e)}async function v(e){let t=`https://en.wikipedia.org/w/rest.php/v1/search/page?q=${e}&limit=8`,o=await b(t);for(let e of o.pages)e.summary=await w(e.key);return o.pages}function k(){let e=document.querySelector("div.page-content-container.show").querySelector(".button-container");return[e.querySelector(".copy"),e.querySelector(".insert-block"),e.querySelector(".insert-page")]}c.addEventListener("keyup",(e=async function(e){if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){let e=await v(c.value);l=-1,function(e){f();let t=0;for(let o of e)a.insertAdjacentHTML("beforeend",`<li data-page-id="${o.id}" tabindex="-1" data-index="${t}">${o.title}</li>`),t+=1,r.insertAdjacentHTML("beforeend",`<div class="hide page-content-container" data-page-id="${o.id}" data-page-title="${o.title}">
                <div class="right-footer">
                    <div class="button-container">
                        <button tabindex="0" data-index="0" class="copy footer-button">Copy <i class="bi bi-stickies"></i></button>
                        <button tabindex="0" data-index="1" class="insert-block footer-button">+ Block <i class="bi bi-box"></i></button>
                        <button tabindex="0" data-index="2" class="insert-page footer-button">+ Page <i class="bi bi-file-earmark-plus"></i></button>
                    </div>
                </div>
                <p class="content">${o.summary}</p>
            </div>`);for(let e of a.querySelectorAll("li"))e.addEventListener("mouseover",()=>e.focus()),e.addEventListener("focus",()=>{for(let t of(l=Number(e.dataset.index),r.querySelectorAll("div.page-content-container")))t.dataset.pageId!==e.dataset.pageId?(t.classList.add("hide"),t.classList.remove("show")):(t.classList.add("show"),t.classList.remove("hide"))});for(let e of r.querySelectorAll("div.page-content-container")){let t=e.dataset.pageTitle,o=e.querySelector("p").textContent;for(let i of(e.querySelector("button.insert-block").addEventListener("click",async e=>{e.stopPropagation(),await g(t,o),u()},{once:!0}),e.querySelector("button.insert-page").addEventListener("click",async e=>{e.stopPropagation(),await m(t,o),u()},{once:!0}),e.querySelector("button.copy").addEventListener("click",async e=>{e.stopPropagation(),await navigator.clipboard.writeText(`${t}: ${o}`),u()},{once:!0}),e.querySelectorAll("button")))i.addEventListener("mouseover",()=>i.focus())}}(e)}},n=0,function(...t){clearTimeout(n),n=setTimeout(e.bind(this,...t),300)})),document.addEventListener("keyup",e=>{"f"===e.key&&c.focus()}),document.addEventListener("keyup",e=>{"Escape"===e.key&&u(),e.stopPropagation()}),window.addEventListener("click",e=>{null===e.target.closest("#main-ui")&&u()}),document.addEventListener("keyup",e=>{if(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp"].includes(e.key)){e.stopPropagation();let n=a.querySelectorAll("li");switch(e.key){case"ArrowDown":for(let e of(l===n.length-1?l=0:l+=1,n))if(Number(e.dataset.index)===l){e.focus();break}break;case"ArrowUp":for(let e of(0===l?l=n.length-1:l-=1,n))if(Number(e.dataset.index)===l){e.focus();break}break;case"ArrowRight":if(document.activeElement!==c)for(let e of([t,o,i]=k(),[t,o,i])){if(t===document.activeElement){o.focus();break}if(o===document.activeElement){i.focus();break}if(i===document.activeElement)break;t.focus();break}break;case"ArrowLeft":if(document.activeElement!==c)for(let e of([t,o,i]=k(),[t,o,i])){if(i===document.activeElement){o.focus();break}o===document.activeElement&&t.focus();break}}}}),document.addEventListener("keyup",e=>{"Enter"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),[t,o,i].includes(document.activeElement)&&document.activeElement.click())}),window.addEventListener("keydown",e=>{["ArrowDown","ArrowLeft","ArrowRight","ArrowUp"].includes(e.key)&&document.activeElement!==c&&e.preventDefault()}),logseq.Editor.registerSlashCommand("Search Wikipedia",async()=>{let{left:e,rect:t}=await logseq.Editor.getEditingCursorPosition(),o=0,i=0;logseq.showMainUI({autoFocus:!0}),setTimeout(()=>{o=t.x+e+500+10>window.innerWidth?t.x+e-500-10:t.x+e,i=t.bottom+400+10>window.innerHeight?t.y-400-10:t.bottom,Object.assign(s.style,{top:i+"px",left:o+"px"}),d.style.visibility="visible",c.focus()},100)})}).catch(console.error);